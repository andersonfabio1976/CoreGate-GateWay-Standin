<div class="verifier-container">
  <h2 class="title">ğŸ§¾ Verificador de RelatÃ³rios CoreGate</h2>

  <!-- Ãrea de upload -->
  <div
    class="drop-zone"
    (drop)="onFileDropped($event.dataTransfer.files[0])"
    (dragover)="$event.preventDefault()"
    (click)="fileInput.click()"
  >
    <input
      type="file"
      #fileInput
      hidden
      accept="application/pdf"
      (change)="onFileSelected($event)"
    />
    <ng-container *ngIf="!loading && !result && !error">
      <p>Arraste e solte o PDF aqui, ou clique para selecionar</p>
    </ng-container>
    <ng-container *ngIf="loading">
      <p>â³ Verificando relatÃ³rio...</p>
    </ng-container>
  </div>

  <!-- Resultado -->
  <div *ngIf="result" class="result-card" [ngClass]="{ valid: result.valid, invalid: !result.valid }">
    <h3>{{ result.valid ? 'âœ… RelatÃ³rio AutÃªntico' : 'âš ï¸ RelatÃ³rio Modificado ou Corrompido' }}</h3>
    <p><strong>Arquivo:</strong> {{ result.filename }}</p>
    <p><strong>Verificado em:</strong> {{ result.verifiedAt }}</p>
    <p><strong>Mensagem:</strong> {{ result.message }}</p>

    <div class="hash-section">
      <p><strong>Hash Embutido:</strong></p>
      <code>{{ result.embeddedHash }}</code>
      <p><strong>Hash Calculado:</strong></p>
      <code>{{ result.computedHash }}</code>
    </div>

    <button (click)="exportResult(result!)" class="export-btn">ğŸ“¤ Exportar JSON Assinado</button>
  </div>

  <!-- Erro -->
  <div *ngIf="error" class="error-card">
    <h3>ğŸ’¥ Erro</h3>
    <p>{{ error }}</p>
  </div>

  <!-- HistÃ³rico -->
  <div *ngIf="history.length > 0" class="history">
    <h3>ğŸ“œ Ãšltimas verificaÃ§Ãµes</h3>
    <table>
      <thead>
      <tr>
        <th>Arquivo</th>
        <th>Status</th>
        <th>Data</th>
        <th>AÃ§Ãµes</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let h of history">
        <td>{{ h.filename }}</td>
        <td [class.valid]="h.valid" [class.invalid]="!h.valid">
          {{ h.valid ? 'AutÃªntico' : 'Modificado' }}
        </td>
        <td>{{ h.verifiedAt | date:'dd/MM/yyyy HH:mm' }}</td>
        <td>
          <button (click)="exportResult(h)" title="Exportar JSON">ğŸ“¤</button>
        </td>
      </tr>
      </tbody>
    </table>
    <button class="clear-btn" (click)="clearHistory()">ğŸ§¹ Limpar histÃ³rico</button>
  </div>

  <button *ngIf="result || error" (click)="reset()" class="reset-btn">Nova verificaÃ§Ã£o</button>
</div>
