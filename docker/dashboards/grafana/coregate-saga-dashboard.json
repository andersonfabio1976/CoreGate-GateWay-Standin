{
  "title": "CoreGate ‚Äî Saga & Performance Metrics",
  "uid": "coregate-saga-dashboard",
  "timezone": "browser",
  "schemaVersion": 37,
  "refresh": "5s",
  "panels": [
    {
      "type": "stat",
      "title": "üß≠ Modo Operacional Atual",
      "targets": [
        { "expr": "coregate_operational_mode_state" }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "mappings": [
            { "type": "value", "options": { "0": { "text": "GATEWAY", "color": "green" } } },
            { "type": "value", "options": { "1": { "text": "STANDIN_AUTOMATIC", "color": "orange" } } },
            { "type": "value", "options": { "2": { "text": "STANDIN_REQUESTED", "color": "red" } } },
            { "type": "value", "options": { "-1": { "text": "UNKNOWN", "color": "gray" } } }
          ]
        }
      }
    },
    {
      "type": "stat",
      "title": "üíæ Estado do Cache",
      "targets": [
        { "expr": "coregate_operational_cache_mode" }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "mappings": [
            { "type": "value", "options": { "0": { "text": "Redis (Persistente)", "color": "green" } } },
            { "type": "value", "options": { "1": { "text": "In-Memory (Vol√°til)", "color": "orange" } } }
          ]
        }
      }
    },
    {
      "type": "timeseries",
      "title": "‚è± Transaction Duration (P95)",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(coregate_transaction_duration_ms_bucket[5m])) by (le, tenant, type))"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "orange", "value": 300 },
              { "color": "red", "value": 500 }
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "‚úÖ Success vs ‚ùå Failure (by Tenant)",
      "targets": [
        { "expr": "sum(rate(coregate_transaction_success_total[5m])) by (tenant)" },
        { "expr": "sum(rate(coregate_transaction_failure_total[5m])) by (tenant)" }
      ],
      "fieldConfig": {
        "defaults": { "unit": "ops/s" }
      }
    },
    {
      "type": "gauge",
      "title": "‚ö° TPS por Tenant",
      "targets": [
        { "expr": "coregate_tps_per_tenant" }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s",
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": 0 },
              { "color": "orange", "value": 2 },
              { "color": "green", "value": 5 }
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "‚Ü©Ô∏è Saga Rollback Chain (por Tenant/Modo)",
      "targets": [
        {
          "expr": "sum(rate(coregate_saga_rollback_total[5m])) by (tenant, mode, type)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "red", "value": 0.05 }
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "üß© Rollback Steps & Dura√ß√£o M√©dia",
      "targets": [
        { "expr": "avg(coregate_saga_rollback_step_total) by (tenant)" },
        {
          "expr": "histogram_quantile(0.95, sum(rate(coregate_saga_rollback_duration_ms_bucket[5m])) by (le, tenant))"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "ms" }
      }
    },
    {
      "type": "timeseries",
      "title": "üîÑ Saga Step Execution Rate (per Tenant/Step)",
      "targets": [
        { "expr": "sum(rate(coregate_saga_step_executed_total[5m])) by (tenant, step)" },
        { "expr": "sum(rate(coregate_saga_step_failed_total[5m])) by (tenant, step)" }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s",
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "‚è± Saga Step Duration (P95)",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(coregate_saga_step_duration_ms_bucket[5m])) by (le, tenant, step))"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "ms" }
      }
    },
    {
      "type": "timeseries",
      "title": "üß† Saga Completion Rate (por Modo e Status)",
      "targets": [
        {
          "expr": "sum(rate(coregate_saga_completed[5m])) by (mode, status)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s",
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "lines", "lineWidth": 2 }
        }
      }
    }
  ],
  "time": { "from": "now-15m", "to": "now" },
  "templating": { "list": [] },
  "annotations": { "list": [] }
}
